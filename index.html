<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Herbal&Heaven | Premium Organic Rituals</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* ---------- 1. Variables & Reset ---------- */
:root {
  --primary: #2d4a22;
  --primary-hover: #1e3316;
  --secondary: #f4e9d5;
  --accent: #c5a059;
  --text-dark: #2c2c2c;
  --white: #ffffff;
  --danger: #e74c3c;
  --success: #27ae60;
  --font-heading: 'Playfair Display', serif;
  --font-body: 'Lato', sans-serif;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);
  --radius: 8px;
  --transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); /* Faster transition */
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html { scroll-behavior: smooth; }
body {
  font-family: var(--font-body);
  background-color: #fdfbf7;
  color: var(--text-dark);
  line-height: 1.6;
  overflow-x: hidden;
  padding-bottom: 80px; /* Increased space for bottom bar */
}

h1, h2, h3, h4 { font-family: var(--font-heading); color: var(--primary); }
a { text-decoration: none; color: inherit; transition: var(--transition); }
button { cursor: pointer; border: none; outline: none; font-family: var(--font-body); }
img { max-width: 100%; display: block; }
input, textarea, select { font-family: var(--font-body); }

/* ---------- 2. Animations (Optimized) ---------- */
.animate-in { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; will-change: opacity, transform; }
.animate-in.visible { opacity: 1; transform: translateY(0); }

@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
@keyframes cartAdd { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

.float { animation: float 3s ease-in-out infinite; will-change: transform; }
.cart-animation { animation: cartAdd 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

/* ---------- 3. UI Components ---------- */
.container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  padding: 10px 20px; border-radius: 50px; font-weight: 700;
  letter-spacing: 0.5px; transition: var(--transition);
  text-transform: uppercase; font-size: 11px;
}

.btn-primary { background: var(--primary); color: var(--white); box-shadow: 0 4px 15px rgba(45, 74, 34, 0.3); }
.btn-primary:active { transform: scale(0.96); } /* Better touch feedback */

.btn-secondary { background: transparent; color: var(--primary); border: 1px solid var(--primary); }
.btn-secondary:hover { background: var(--primary); color: var(--white); }

.badge, .stock-badge {
  position: absolute; color: white; border-radius: 50px; z-index: 2;
  text-transform: uppercase; font-weight: bold;
}
.badge { top: 15px; left: 15px; background: var(--accent); padding: 4px 12px; font-size: 10px; letter-spacing: 1px; }
.stock-badge { top: 15px; right: 15px; background: var(--danger); padding: 4px 8px; font-size: 9px; border-radius: 4px; }

/* ---------- 4. Header ---------- */
header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(253, 251, 247, 0.95);
  backdrop-filter: blur(10px); /* Smooth blur */
  -webkit-backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0,0,0,0.05);
  padding: 10px 0;
  transition: transform 0.3s ease;
}

.nav-wrapper { display: flex; justify-content: space-between; align-items: center; }

.logo { display: flex; align-items: center; gap: 8px; font-family: var(--font-heading); font-size: 18px; font-weight: 700; color: var(--primary); }
.logo img { height: 40px; width: 40px; border-radius: 50%; object-fit: cover; }

/* Desktop Menu */
.nav-menu { display: flex; gap: 20px; align-items: center; }
.nav-menu a { font-size: 13px; font-weight: 700; color: var(--text-dark); position: relative; padding: 5px 0; }
.nav-menu a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background: var(--accent); transition: var(--transition); }
.nav-menu a:hover::after { width: 100%; }

.signin-btn { border: 1px solid var(--primary); padding: 6px 15px; border-radius: 20px; font-size: 12px; transition: 0.3s; }
.signin-btn:hover { background: var(--primary); color: white; }
.user-info { display: none; font-size: 12px; font-weight: bold; color: var(--primary); cursor: pointer; }

.nav-icons { display: flex; align-items: center; gap: 15px; }
.cart-icon-wrap, .wishlist-icon-wrap { position: relative; cursor: pointer; font-size: 20px; padding: 5px; color: var(--text-dark); }
.cart-count, .wishlist-count {
  position: absolute; top: -5px; right: -5px; background: var(--danger); color: white;
  width: 16px; height: 16px; border-radius: 50%; font-size: 9px;
  display: flex; align-items: center; justify-content: center;
}
.wishlist-count { background: var(--accent); }

.top-contact { background:#345b2a; color:#fff; text-align:center; padding:5px 10px; font-size:0.75rem; font-weight: 600; }

/* ---------- 5. Mobile Bottom Navigation (NEW) ---------- */
.bottom-nav {
    display: none; /* Hidden on Desktop */
    position: fixed; bottom: 0; left: 0; width: 100%;
    background: white; border-top: 1px solid #eee;
    z-index: 1000;
    justify-content: space-around;
    padding: 10px 0;
    box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
    padding-bottom: max(10px, env(safe-area-inset-bottom));
}

.nav-item {
    display: flex; flex-direction: column; align-items: center;
    color: #888; font-size: 10px; font-weight: 600; gap: 4px;
    background: none; width: 100%;
}
.nav-item i { font-size: 20px; margin-bottom: 2px; transition: 0.2s; }
.nav-item.active { color: var(--primary); }
.nav-item.active i { transform: translateY(-2px); }

/* ---------- 6. Hero Section ---------- */
.hero {
  position: relative; height: 60vh; min-height: 400px;
  background: url('https://images.unsplash.com/photo-1540555700478-4be289fbecef?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') center/cover no-repeat;
  display: flex; align-items: center; margin-bottom: 40px;
}
.hero::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to right, rgba(0,0,0,0.6), rgba(0,0,0,0.1)); }
.hero-content { position: relative; z-index: 2; color: white; max-width: 600px; padding-left: 5%; animation: fadeInUp 0.8s ease-out; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

/* ---------- 7. Components & Grids ---------- */
.countdown-timer { background: var(--secondary); padding: 15px; text-align: center; margin: 20px auto; border-radius: var(--radius); max-width: 500px; }
.timer-container { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
.timer-box { background: white; padding: 5px 10px; border-radius: 8px; min-width: 55px; box-shadow: var(--shadow); }
.timer-value { font-size: 20px; font-weight: bold; color: var(--primary); }

.products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding-bottom: 50px; }
/* Improved Desktop Grid */
@media(min-width: 768px) { .products-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; } }

.product-card {
  background: white; border-radius: var(--radius); overflow: hidden;
  box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: var(--transition); border: 1px solid #f0f0f0;
  position: relative; height: 100%; display: flex; flex-direction: column;
}
.product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }

.product-img { height: 180px; overflow: hidden; position: relative; background: #f9f9f9; cursor: pointer; }
.product-img img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
.product-card:hover .product-img img { transform: scale(1.05); }

.wishlist-btn {
  position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9);
  width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
  cursor: pointer; z-index: 3; transition: 0.2s; color: #ccc;
}
.wishlist-btn.active { background: var(--danger); color: white; }

.product-info { padding: 12px; text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
.product-title { font-size: 14px; margin: 6px 0; color: var(--text-dark); cursor: pointer; font-weight: 700; }
.product-price { font-weight: 700; color: var(--primary); font-size: 15px; margin-bottom: 8px; }

.card-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 10px; }
.card-btns .btn { padding: 8px 0; font-size: 10px; width: 100%; }

/* ---------- 8. Modals & Overlay ---------- */
.overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  z-index: 999; opacity: 0; visibility: hidden; transition: opacity 0.3s ease;
}
.overlay.active { opacity: 1; visibility: visible; }

.modal {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95);
  width: 90%; max-width: 450px; background: white;
  z-index: 1000; border-radius: 12px; padding: 25px;
  opacity: 0; visibility: hidden; transition: var(--transition);
  box-shadow: 0 25px 50px rgba(0,0,0,0.25);
  max-height: 85vh; overflow-y: auto;
}
.modal.active { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }

/* ---------- 9. Cart Drawer ---------- */
.cart-drawer {
  position: fixed; top: 0; right: -100%; width: 100%; max-width: 380px; height: 100%;
  background: white; z-index: 1002; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  display: flex; flex-direction: column; box-shadow: -5px 0 25px rgba(0,0,0,0.1);
  will-change: transform;
}
.cart-drawer.active { right: 0; transform: translateX(0); }

.cart-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; background: #fff; padding: 8px; border-bottom: 1px solid #f0f0f0; }
.cart-item img { width: 50px; height: 50px; border-radius: 6px; object-fit: cover; }
.qty-btn { width: 24px; height: 24px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; }

/* ---------- 10. Utils ---------- */
.search-box { position: relative; width: 100%; max-width: 400px; margin: 0 auto 20px auto; }
.search-box input { width: 100%; padding: 12px 20px; padding-right: 40px; border-radius: 50px; border: 1px solid #ddd; outline: none; }
.search-box i { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); }

.filter-btn { padding: 6px 15px; border-radius: 20px; border: 1px solid #eee; background: white; margin: 0 4px; font-size: 12px; transition: 0.2s; }
.filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

.toast {
  position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: rgba(30,30,30,0.95); color: white; padding: 10px 20px; border-radius: 30px;
  font-size: 13px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 2000;
  display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Responsive Tweaks */
@media (max-width: 768px) {
  .nav-menu { display: none; } /* Hide Desktop Menu */
  .bottom-nav { display: flex; } /* Show Bottom Nav */
  .mobile-hide { display: none; }
  .hero { height: 45vh; }
  .hero h1 { font-size: 28px; }
  .cart-drawer { width: 85%; }
  
  /* Fix layout shifts */
  header .logo span { font-size: 16px; }
  .section-title h2 { font-size: 24px; }
  
  /* Make horizontal scroll smoother */
  .filter-container { overflow-x: auto; white-space: nowrap; padding-bottom: 10px; -webkit-overflow-scrolling: touch; }
}
</style>
</head>
<body>

<div class="top-contact">
  Free Shipping on orders above ‚Çπ499 | Support: +91-9595641664
</div>

<header>
  <div class="container nav-wrapper">
    <a href="#" class="logo">
      <img src="herb.jpg" alt="Logo" loading="lazy">
      <span>Herbal&Heaven</span>
    </a>
    
    <nav class="nav-menu">
      <a href="#home">Home</a>
      <a href="#products">Shop</a>
      <a href="#" onclick="openTrackOrder()">Track</a>
      <a href="#" onclick="openReturnOrder()">Return</a>
      
      <a href="#" class="signin-btn" id="signInBtn" onclick="openSignIn()">Sign In</a>
      <div class="user-info" id="userInfo" onclick="openUserDashboard()">
          <i class="fa-solid fa-user"></i> <span id="userNameDisplay">User</span>
      </div>
      <a href="#" onclick="openAdminLogin()" style="color:#888; font-size:11px;">Admin</a>
    </nav>
    
    <div class="nav-icons mobile-hide">
      <div class="wishlist-icon-wrap" onclick="openWishlist()">
        <i class="fa-regular fa-heart"></i>
        <span class="wishlist-count" id="wishlistCount">0</span>
      </div>
      <div class="cart-icon-wrap" onclick="toggleCart()">
        <i class="fa-solid fa-shopping-bag"></i>
        <span class="cart-count" id="cartCount">0</span>
      </div>
    </div>

    <div class="nav-icons" style="display:none;" id="mobileHeaderIcons">
       <div class="cart-icon-wrap" onclick="toggleCart()">
         <i class="fa-solid fa-shopping-bag"></i>
         <span class="cart-count" id="mobileCartCount">0</span>
       </div>
    </div>
  </div>
</header>

<section id="home" class="hero">
  <div class="container hero-content">
    <span style="color:var(--accent); font-weight:700; letter-spacing:1px; margin-bottom:10px; display:block;">100% ORGANIC</span>
    <h1>Nature's Purest <br>Secret for You</h1>
    <p>Handcrafted, chemical-free skincare rituals designed for your inner glow.</p>
    <button class="btn btn-primary" onclick="document.getElementById('products').scrollIntoView({behavior: 'smooth'})">Shop Now</button>
  </div>
</section>

<div class="countdown-timer animate-in">
  <h3 style="color: var(--primary); margin-bottom: 10px; font-size:14px;">üéÅ Offer Ends In:</h3>
  <div class="timer-container">
    <div class="timer-box"><div class="timer-value" id="days">00</div><div style="font-size:10px">Days</div></div>
    <div class="timer-box"><div class="timer-value" id="hours">00</div><div style="font-size:10px">Hrs</div></div>
    <div class="timer-box"><div class="timer-value" id="minutes">00</div><div style="font-size:10px">Min</div></div>
    <div class="timer-box"><div class="timer-value" id="seconds">00</div><div style="font-size:10px">Sec</div></div>
  </div>
</div>

<section id="products" class="container" style="margin-top: 40px;">
  <div class="section-title" style="text-align: center; margin-bottom: 20px;">
    <h2>Curated Rituals</h2>
  </div>

  <div class="filter-container" style="text-align:center; margin-bottom:20px;">
    <div class="search-box">
      <input type="text" id="search" placeholder="Search soaps, oils..." onkeyup="filterProducts()">
      <i class="fa-solid fa-search"></i>
    </div>
    <div style="overflow-x: auto; white-space: nowrap; padding-bottom: 5px;">
      <button class="filter-btn active" onclick="filterCat('all', this)">All</button>
      <button class="filter-btn" onclick="filterCat('Face', this)">Face</button>
      <button class="filter-btn" onclick="filterCat('Body', this)">Body</button>
      <button class="filter-btn" onclick="filterCat('Glow', this)">Glow</button>
    </div>
  </div>

  <div class="products-grid" id="productsGrid">
    </div>
</section>

<div class="bottom-nav">
    <button class="nav-item active" onclick="scrollToTop()">
        <i class="fa-solid fa-house"></i>
        <span>Home</span>
    </button>
    <button class="nav-item" onclick="document.getElementById('products').scrollIntoView({behavior: 'smooth'})">
        <i class="fa-solid fa-store"></i>
        <span>Shop</span>
    </button>
    <button class="nav-item" onclick="toggleCart()">
        <i class="fa-solid fa-shopping-bag"></i>
        <span>Bag</span>
    </button>
    <button class="nav-item" onclick="handleMobileProfileClick()">
        <i class="fa-solid fa-user"></i>
        <span>Profile</span>
    </button>
    <button class="nav-item" onclick="openTrackOrder()">
        <i class="fa-solid fa-truck-fast"></i>
        <span>Track</span>
    </button>
</div>

<footer style="background: #222; color: #fff; padding: 40px 0 80px 0; text-align: center; margin-top: 50px;">
  <div class="container">
    <h3>Herbal&Heaven</h3>
    <p style="color: #888; font-size: 13px; margin-top: 10px;">Nature's Pure Essence.</p>
    <div style="margin-top: 20px; display:flex; justify-content:center; gap:20px; font-size:20px;">
        <a href="https://wa.me/919595641664"><i class="fa-brands fa-whatsapp"></i></a>
        <a href="https://instagram.com/aose_clothing"><i class="fa-brands fa-instagram"></i></a>
    </div>
  </div>
</footer>

<div class="overlay" id="cartOverlay" onclick="toggleCart()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
    <h3>Your Bag</h3>
    <button onclick="toggleCart()" style="background:none; font-size:20px;"><i class="fa-solid fa-times"></i></button>
  </div>
  <div class="cart-body" id="cartItems" style="flex: 1; overflow-y: auto; padding: 15px;"></div>
  <div style="padding: 20px; background: #fdfbf7; border-top: 1px solid #eee;">
    <div style="display:flex; justify-content:space-between; font-weight:700; margin-bottom:15px;">
      <span>Total</span>
      <span id="cartTotal">‚Çπ0</span>
    </div>
    <button class="btn btn-primary" style="width:100%;" onclick="openCheckout()">Checkout</button>
  </div>
</div>

<div class="modal" id="wishlistModal">
    <button onclick="closeModal('wishlistModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>My Wishlist</h3>
    <div id="wishlistItems" style="margin-top: 15px;"></div>
</div>

<div class="modal" id="quickViewModal">
    <button onclick="closeModal('quickViewModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <div id="quickViewContent"></div>
</div>

<div class="modal" id="signInModal">
    <button onclick="closeModal('signInModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>Sign In</h3>
    <form onsubmit="handleSignIn(event)" style="margin-top:15px;">
        <input type="text" id="signName" placeholder="Name" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;" required>
        <input type="email" id="signEmail" placeholder="Email" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;" required>
        <input type="tel" id="signPhone" placeholder="Phone" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;" required>
        <button type="submit" class="btn btn-primary" style="width:100%;">Access Account</button>
    </form>
</div>

<div class="modal" id="userModal">
    <button onclick="closeModal('userModal')" style="position: absolute; right: 15px; top: 15px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>Profile</h3>
    <h4 id="dashboardName" style="color:#555; margin:5px 0 15px 0;"></h4>
    <div id="userOrderHistory" style="max-height:200px; overflow-y:auto; border:1px solid #eee; padding:10px; border-radius:5px; margin-bottom:15px;"></div>
    <button class="btn btn-secondary" style="width:100%;" onclick="handleSignOut()">Sign Out</button>
</div>

<div class="modal" id="checkoutModal">
  <button onclick="closeModal('checkoutModal')" style="position: absolute; right: 15px; top: 15px; background:none;"><i class="fa-solid fa-times"></i></button>
  
  <div id="step1">
    <h3>Shipping</h3>
    <form onsubmit="goToPayment(event)" style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
      <input id="cName" type="text" placeholder="Full Name" style="padding:10px; border:1px solid #ddd; border-radius:5px;" required>
      <input id="cEmail" type="email" placeholder="Email" style="padding:10px; border:1px solid #ddd; border-radius:5px;" required>
      <input id="cPhone" type="tel" placeholder="Phone" style="padding:10px; border:1px solid #ddd; border-radius:5px;" required>
      <textarea id="cAddr" rows="2" placeholder="Address" style="padding:10px; border:1px solid #ddd; border-radius:5px;" required></textarea>
      <button type="submit" class="btn btn-primary" style="width:100%;">Proceed to Pay</button>
    </form>
  </div>

  <div id="step2" style="display:none; text-align:center;">
    <h3>Payment</h3>
    <p style="margin:10px 0;">Total: <strong id="payAmount" style="font-size:18px; color:var(--primary);"></strong></p>
    <div style="display:grid; gap:10px; margin-bottom:20px;">
      <button class="btn" style="background:#4285F4; color:white;" onclick="pay('Google Pay')">Google Pay</button>
      <button class="btn" style="background:#5F259F; color:white;" onclick="pay('PhonePe')">PhonePe</button>
      <button class="btn" style="background:#00B9F1; color:white;" onclick="pay('Paytm')">Paytm</button>
    </div>
    <div id="qrImgContainer" style="margin: 10px auto;"></div>
    <button class="btn btn-success" style="background:var(--success); color:white; width:100%;" onclick="confirmOrder()">Confirm Payment</button>
  </div>
  
  <div id="step3" style="display:none; text-align:center;">
    <i class="fa-solid fa-circle-check" style="color:var(--success); font-size:50px; margin-bottom:15px;"></i>
    <h3>Order Placed!</h3>
    <p id="finalOrderId" style="font-weight:bold; font-family:monospace; margin:10px 0;"></p>
    <button class="btn btn-primary" onclick="downloadInvoice()">Download Invoice</button>
  </div>
</div>

<div class="toast" id="toast">Item added to cart</div>

<div id="invoiceTemplate" style="display:none; padding:20px; font-family:sans-serif;">
    <h2 style="text-align:center;">Herbal&Heaven</h2>
    <p style="text-align:center; font-size:12px; color:#666;">Invoice</p>
    <div id="invContent" style="margin-top:20px;"></div>
</div>

<div class="modal" id="trackModal">
    <button onclick="closeModal('trackModal')" style="position: absolute; right: 15px; top: 10px;"><i class="fa-solid fa-times"></i></button>
    <h3>Track Order</h3>
    <div style="display:flex; gap:10px; margin-top:15px;">
        <input type="text" id="trackInput" placeholder="Order ID" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:5px;">
        <button class="btn btn-primary" onclick="trackOrderNow()">Go</button>
    </div>
    <div id="trackResult" style="margin-top:15px; font-size:13px;"></div>
</div>

<div class="modal" id="returnModal">
    <button onclick="closeModal('returnModal')" style="position: absolute; right: 15px; top: 10px;"><i class="fa-solid fa-times"></i></button>
    <h3>Return</h3>
    <input type="text" id="returnInput" placeholder="Order ID" style="width:100%; padding:10px; margin:15px 0; border:1px solid #ddd; border-radius:5px;">
    <button class="btn btn-primary" style="width:100%;" onclick="fetchReturnItems()">Fetch Items</button>
</div>

<div class="modal" id="adminModal">
    <button onclick="closeModal('adminModal')" style="position: absolute; right: 15px; top: 10px;"><i class="fa-solid fa-times"></i></button>
    <h3>Admin</h3>
    <div id="adminLogin">
        <input type="password" id="admPass" placeholder="Password" style="width:100%; padding:10px; margin:15px 0; border:1px solid #ddd; border-radius:5px;">
        <button class="btn btn-primary" onclick="checkAdmin()">Login</button>
    </div>
    <div id="adminDash" style="display:none;">
        <div style="max-height:300px; overflow:auto;"><table id="orderTable" style="width:100%; font-size:11px;"></table></div>
    </div>
</div>

<script>
// --- CONFIG ---
const UPI_ID = "damareomkar96@oksbi";
const ADMIN_PASS = "omti96";
const OWNER_PHONE = "919595641664";

// --- DATA ---
const products = [
  { id: 1, name: "Neem Soap", cat: "Face", price: 150, img: "proo.jpg", stock: 15, rating: 4.5, desc: "Purifying neem soap for clear skin." },
  { id: 2, name: "Papaya Soap", cat: "Glow", price: 150, img: "pro.jpg", stock: 8, rating: 4.7, desc: "Papaya enzyme soap for radiant skin." },
  { id: 3, name: "Tulsi Soap", cat: "Body", price: 150, img: "pro1.jpg", stock: 20, rating: 4.3, desc: "Holy basil soap for body purification." },
  { id: 4, name: "Aloe Vera", cat: "Face", price: 150, img: "pro4.jpg", stock: 25, rating: 4.8, desc: "Soothing aloe vera gel for sensitive skin." },
  { id: 5, name: "Detan Bar", cat: "Glow", price: 150, img: "pro5.jpg", stock: 12, rating: 4.6, desc: "Tan removal bar for glowing skin." },
  { id: 6, name: "Rose Soap", cat: "Body", price: 150, img: "pro3.jpg", stock: 18, rating: 4.4, desc: "Rose petal soap for silky smooth skin." },
  { id: 7, name: "Charcoal", cat: "Face", price: 150, img: "pro7.jpg", stock: 10, rating: 4.9, desc: "Activated charcoal soap for deep cleansing." },
  { id: 8, name: "Multani", cat: "Glow", price: 150, img: "pro8.jpg", stock: 22, rating: 4.2, desc: "Fuller's earth soap for pore cleansing." }
];

// --- STATE ---
let cart = JSON.parse(localStorage.getItem('hh_cart') || '[]');
let wishlist = JSON.parse(localStorage.getItem('hh_wishlist') || '[]');
let orders = JSON.parse(localStorage.getItem('hh_orders') || '[]');
let currentUser = JSON.parse(localStorage.getItem('hh_current_user') || 'null');
let currentOrder = null;

// --- INIT ---
window.onload = () => {
    renderProducts(products);
    updateCart();
    updateUserUI();
    updateWishlistCount();
    startCountdown();
    
    // Optimized Scroll Listener
    let scrollTimeout;
    const animateElements = document.querySelectorAll('.animate-in');
    
    window.addEventListener('scroll', () => {
        if (!scrollTimeout) {
            scrollTimeout = setTimeout(() => {
                scrollTimeout = null;
                // Animate on scroll logic
                animateElements.forEach(el => {
                    if(el.getBoundingClientRect().top < window.innerHeight * 0.9) {
                        el.classList.add('visible');
                    }
                });
            }, 50); // Throttle to 50ms
        }
    });
    
    // Trigger initial animations
    setTimeout(() => window.dispatchEvent(new Event('scroll')), 100);
    
    // Mobile Check for Layout
    if(window.innerWidth <= 768) {
        document.getElementById('mobileHeaderIcons').style.display = 'flex';
    }
};

// --- CORE FUNCTIONS ---
function renderProducts(list) {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = list.map((p, i) => {
        const isWished = wishlist.find(w => w.id === p.id);
        const stockHtml = p.stock < 10 ? `<div class="stock-badge">Only ${p.stock} left</div>` : '';
        return `
        <div class="product-card animate-in">
            <div class="badge">Pure</div>
            ${stockHtml}
            <div class="wishlist-btn ${isWished ? 'active' : ''}" onclick="toggleWishlist(${p.id}, event)">
                <i class="fa-${isWished ? 'solid' : 'heart'} fa-heart"></i>
            </div>
            <div class="product-img" onclick="openQuickView(${p.id})">
                <img src="${p.img}" alt="${p.name}" loading="lazy">
            </div>
            <div class="product-info">
                <div>
                    <h3 class="product-title" onclick="openQuickView(${p.id})">${p.name}</h3>
                    <div class="product-price">‚Çπ${p.price}</div>
                    <div style="font-size:12px; color:#f39c12;">${'‚òÖ'.repeat(Math.floor(p.rating))}<span style="color:#ddd;">${'‚òÖ'.repeat(5-Math.floor(p.rating))}</span></div>
                </div>
                <div class="card-btns">
                    <button class="btn btn-primary" onclick="addToCart(${p.id}, event)">Add</button>
                    <button class="btn btn-secondary" onclick="buyNow(${p.id}, event)">Buy</button>
                </div>
            </div>
        </div>
        `;
    }).join('');
    
    // Re-trigger animation
    setTimeout(() => {
        document.querySelectorAll('.products-grid .animate-in').forEach(el => el.classList.add('visible'));
    }, 50);
}

function filterProducts() {
    const q = document.getElementById('search').value.toLowerCase();
    const filtered = products.filter(p => p.name.toLowerCase().includes(q) || p.cat.toLowerCase().includes(q));
    renderProducts(filtered);
}

function filterCat(cat, btn) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const filtered = cat === 'all' ? products : products.filter(p => p.cat === cat);
    renderProducts(filtered);
}

// --- CART & WISHLIST ---
function addToCart(id, event) {
    if(event) event.stopPropagation();
    const p = products.find(x => x.id === id);
    const ex = cart.find(x => x.id === id);
    if(ex) {
        if(ex.qty < p.stock) ex.qty++; else return showToast("Out of stock!");
    } else {
        cart.push({...p, qty: 1});
    }
    updateCart();
    showToast("Added to Bag");
    
    // Animate Icon
    const icons = document.querySelectorAll('.cart-icon-wrap i');
    icons.forEach(i => {
        i.classList.add('cart-animation');
        setTimeout(() => i.classList.remove('cart-animation'), 400);
    });
}

function updateCart() {
    localStorage.setItem('hh_cart', JSON.stringify(cart));
    const count = cart.reduce((a,b) => a+b.qty, 0);
    const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
    
    document.getElementById('cartCount').innerText = count;
    document.getElementById('mobileCartCount').innerText = count; // Update Mobile Icon
    document.getElementById('cartTotal').innerText = '‚Çπ' + total;
    
    document.getElementById('cartItems').innerHTML = cart.length ? cart.map(i => `
        <div class="cart-item">
            <img src="${i.img}">
            <div style="flex:1;">
                <div style="font-weight:700; font-size:13px;">${i.name}</div>
                <div style="font-size:11px; color:#666;">‚Çπ${i.price}</div>
            </div>
            <div style="display:flex; align-items:center; gap:8px;">
                <button class="qty-btn" onclick="modQty(${i.id}, -1)">-</button>
                <span style="font-size:12px; font-weight:bold; width:20px; text-align:center;">${i.qty}</span>
                <button class="qty-btn" onclick="modQty(${i.id}, 1)">+</button>
            </div>
        </div>
    `).join('') : '<p style="text-align:center; color:#999; margin-top:20px;">Your bag is empty.</p>';
}

function modQty(id, n) {
    const i = cart.find(x => x.id === id);
    if(i) {
        i.qty += n;
        if(i.qty <= 0) cart = cart.filter(x => x.id !== id);
        else if(i.qty > products.find(p=>p.id===id).stock) i.qty--;
    }
    updateCart();
}

function toggleCart() {
    const d = document.getElementById('cartDrawer');
    const o = document.getElementById('cartOverlay');
    if(d.classList.contains('active')) { d.classList.remove('active'); o.classList.remove('active'); }
    else { d.classList.add('active'); o.classList.add('active'); }
}

function toggleWishlist(id, event) {
    if(event) event.stopPropagation();
    const idx = wishlist.findIndex(w => w.id === id);
    if(idx > -1) { wishlist.splice(idx, 1); showToast("Removed from wishlist"); }
    else { wishlist.push(products.find(p => p.id === id)); showToast("Added to wishlist"); }
    
    localStorage.setItem('hh_wishlist', JSON.stringify(wishlist));
    updateWishlistCount();
    renderProducts(products); // Re-render to update hearts
}

function updateWishlistCount() {
    document.getElementById('wishlistCount').textContent = wishlist.length;
    // Populate Modal
    document.getElementById('wishlistItems').innerHTML = wishlist.length ? wishlist.map(p => `
        <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
            <img src="${p.img}" style="width:40px; height:40px; border-radius:4px;">
            <div style="flex:1; font-size:13px;"><b>${p.name}</b><br>‚Çπ${p.price}</div>
            <button class="btn btn-primary" style="padding:5px 10px; font-size:10px;" onclick="addToCart(${p.id}); closeModal('wishlistModal')">Add</button>
        </div>
    `).join('') : '<p>Empty.</p>';
}

// --- MODALS & UX ---
function openModal(id) { document.getElementById(id).classList.add('active'); document.querySelector('.overlay').classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); document.querySelector('.overlay').classList.remove('active'); }

function openQuickView(id) {
    const p = products.find(x => x.id === id);
    document.getElementById('quickViewContent').innerHTML = `
        <div style="text-align:center;">
            <img src="${p.img}" style="height:200px; margin:0 auto; border-radius:8px;">
            <h2 style="margin:10px 0;">${p.name}</h2>
            <p style="color:#666; font-size:13px; margin-bottom:15px;">${p.desc}</p>
            <h3 style="color:var(--primary);">‚Çπ${p.price}</h3>
            <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="addToCart(${p.id}); closeModal('quickViewModal')">Add to Cart</button>
        </div>
    `;
    openModal('quickViewModal');
}

function showToast(msg) {
    const t = document.getElementById('toast');
    t.innerHTML = `<i class="fa-solid fa-check"></i> ${msg}`;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
}

function scrollToTop() { window.scrollTo({top: 0, behavior: 'smooth'}); }

// --- AUTH & CHECKOUT ---
function handleMobileProfileClick() {
    if(currentUser) openUserDashboard();
    else openSignIn();
}

function openSignIn() { openModal('signInModal'); }

function handleSignIn(e) {
    e.preventDefault();
    currentUser = {
        name: document.getElementById('signName').value,
        email: document.getElementById('signEmail').value,
        phone: document.getElementById('signPhone').value
    };
    localStorage.setItem('hh_current_user', JSON.stringify(currentUser));
    closeModal('signInModal');
    updateUserUI();
    showToast(`Welcome ${currentUser.name}`);
}

function handleSignOut() {
    localStorage.removeItem('hh_current_user');
    currentUser = null;
    closeModal('userModal');
    updateUserUI();
}

function updateUserUI() {
    if(currentUser) {
        document.getElementById('signInBtn').style.display = 'none';
        document.getElementById('userInfo').style.display = 'block';
        document.getElementById('userNameDisplay').innerText = currentUser.name.split(' ')[0];
    } else {
        document.getElementById('signInBtn').style.display = 'block';
        document.getElementById('userInfo').style.display = 'none';
    }
}

function openUserDashboard() {
    if(!currentUser) return;
    document.getElementById('dashboardName').innerText = currentUser.name;
    const myOrders = orders.filter(o => o.email === currentUser.email);
    document.getElementById('userOrderHistory').innerHTML = myOrders.length ? myOrders.map(o => `
        <div style="font-size:11px; border-bottom:1px solid #eee; padding:5px 0;">
            <b>${o.id}</b> - ${o.status}<br>Total: ‚Çπ${o.total} | ${o.date}
        </div>
    `).join('') : 'No orders found.';
    openModal('userModal');
}

function openCheckout() {
    if(!cart.length) return showToast("Cart is empty");
    toggleCart(); openModal('checkoutModal');
    if(currentUser) {
        document.getElementById('cName').value = currentUser.name;
        document.getElementById('cEmail').value = currentUser.email;
        document.getElementById('cPhone').value = currentUser.phone;
    }
    document.getElementById('step1').style.display = 'block';
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'none';
}

function goToPayment(e) {
    e.preventDefault();
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
    const total = cart.reduce((a,b)=>a+(b.price*b.qty),0);
    document.getElementById('payAmount').innerText = '‚Çπ'+total;
    // Generate QR
    const url = `upi://pay?pa=${UPI_ID}&pn=HerbalHeaven&am=${total}&cu=INR`;
    document.getElementById('qrImgContainer').innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(url)}" style="margin:0 auto;">`;
}

function confirmOrder() {
    const total = cart.reduce((a,b)=>a+(b.price*b.qty),0);
    const uid = "ORD-" + Math.floor(Math.random()*10000);
    
    currentOrder = {
        id: uid,
        date: new Date().toLocaleDateString(),
        customer: document.getElementById('cName').value,
        email: document.getElementById('cEmail').value,
        items: [...cart],
        total: total,
        status: 'Placed'
    };
    
    orders.push(currentOrder);
    localStorage.setItem('hh_orders', JSON.stringify(orders));
    
    // Notify Owner
    window.open(`https://wa.me/${OWNER_PHONE}?text=New Order: ${uid} Value: ‚Çπ${total}`, '_blank');
    
    document.getElementById('finalOrderId').innerText = uid;
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'block';
    cart = []; updateCart();
}

function downloadInvoice() {
    const el = document.getElementById('invoiceTemplate');
    document.getElementById('invContent').innerHTML = `
        <p>Order ID: ${currentOrder.id}</p>
        <p>Customer: ${currentOrder.customer}</p>
        <table style="width:100%; border-collapse:collapse; margin-top:10px;">
            <tr><th style="text-align:left;">Item</th><th>Price</th></tr>
            ${currentOrder.items.map(i => `<tr><td>${i.name} x${i.qty}</td><td>${i.price*i.qty}</td></tr>`).join('')}
        </table>
        <h3 style="text-align:right;">Total: ‚Çπ${currentOrder.total}</h3>
    `;
    el.style.display = 'block';
    html2pdf(el).then(() => el.style.display = 'none');
}

function buyNow(id, e) {
    if(e) e.stopPropagation();
    cart = []; addToCart(id); toggleCart(); openCheckout();
}

// --- ADMIN & MISC ---
function checkAdmin() {
    if(document.getElementById('admPass').value === ADMIN_PASS) {
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminDash').style.display = 'block';
        document.getElementById('orderTable').innerHTML = orders.map(o => `
            <tr><td style="padding:5px; border-bottom:1px solid #eee;">
                <b>${o.id}</b> (${o.customer})<br>‚Çπ${o.total} - ${o.status}
            </td></tr>
        `).join('');
    } else alert("Wrong Password");
}

function openTrackOrder() { openModal('trackModal'); }
function trackOrderNow() {
    const id = document.getElementById('trackInput').value;
    const o = orders.find(x => x.id == id);
    document.getElementById('trackResult').innerText = o ? `Status: ${o.status} | Date: ${o.date}` : "Order not found.";
}

function startCountdown() {
    const end = new Date(); end.setDate(end.getDate()+3);
    setInterval(() => {
        const t = end - new Date();
        document.getElementById('days').innerText = Math.floor(t/(1000*60*60*24));
        document.getElementById('hours').innerText = Math.floor((t%(1000*60*60*24))/(1000*60*60));
        document.getElementById('minutes').innerText = Math.floor((t%(1000*60*60))/(1000*60));
        document.getElementById('seconds').innerText = Math.floor((t%(1000*60))/1000);
    }, 1000);
}
</script>
</body>
</html>
