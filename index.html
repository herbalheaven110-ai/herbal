<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Herbal&Heaven | Premium Organic Rituals</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* ---------- 1. Variables & Reset ---------- */
:root {
  --primary: #2d4a22;
  --primary-hover: #1e3316;
  --secondary: #f4e9d5;
  --accent: #c5a059;
  --text-dark: #2c2c2c;
  --white: #ffffff;
  --danger: #e74c3c;
  --success: #27ae60;
  --font-heading: 'Playfair Display', serif;
  --font-body: 'Lato', sans-serif;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);
  --radius: 8px;
  --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html { scroll-behavior: smooth; }
body {
  font-family: var(--font-body);
  background-color: #fdfbf7;
  color: var(--text-dark);
  line-height: 1.6;
  overflow-x: hidden;
  padding-bottom: 70px; /* Space for bottom bar */
}

h1, h2, h3, h4 { font-family: var(--font-heading); color: var(--primary); }
a { text-decoration: none; color: inherit; transition: var(--transition); }
button { cursor: pointer; border: none; outline: none; font-family: var(--font-body); }
img { max-width: 100%; display: block; }
input, textarea, select { font-family: var(--font-body); }

/* ---------- 2. Animations ---------- */
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.animate-in { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; }
.delay-1 { animation-delay: 0.1s; }
.delay-2 { animation-delay: 0.2s; }

/* ---------- 3. UI Components ---------- */
.container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  padding: 10px 20px;
  border-radius: 50px;
  font-weight: 700;
  letter-spacing: 0.5px;
  transition: var(--transition);
  text-transform: uppercase;
  font-size: 11px;
}

.btn-primary {
  background: var(--primary); color: var(--white);
  box-shadow: 0 4px 15px rgba(45, 74, 34, 0.3);
}
.btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }

.btn-secondary {
  background: transparent; color: var(--primary); border: 1px solid var(--primary);
}
.btn-secondary:hover { background: var(--primary); color: var(--white); }

.btn-icon {
    width: 32px; height: 32px; border-radius: 50%; display: inline-flex; 
    align-items: center; justify-content: center; color: white; margin-left: 5px;
}

.badge {
  position: absolute; top: 15px; left: 15px;
  background: var(--accent); color: white;
  padding: 4px 12px; font-size: 10px;
  border-radius: 50px; text-transform: uppercase; letter-spacing: 1px;
  z-index: 2;
}

/* ---------- 4. Header ---------- */
header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(253, 251, 247, 0.98);
  border-bottom: 1px solid rgba(0,0,0,0.05);
  padding: 10px 0;
  will-change: transform;
}

.nav-wrapper { display: flex; justify-content: space-between; align-items: center; }

.logo {
  display: flex; align-items: center; gap: 8px;
  font-family: var(--font-heading); font-size: 18px; font-weight: 700; color: var(--primary);
}
.logo img { 
    height: 45px; width: 45px; border-radius: 50%; object-fit: cover;
    animation: rotateLogo 20s linear infinite;
}
@keyframes rotateLogo { 100% { transform: rotate(360deg); } }

.nav-menu { display: flex; gap: 20px; align-items: center; }
.nav-menu a { font-size: 13px; font-weight: 700; color: var(--text-dark); position: relative; }
.nav-menu a::after {
  content: ''; position: absolute; bottom: -4px; left: 0; width: 0; height: 2px;
  background: var(--accent); transition: var(--transition);
}
.nav-menu a:hover::after { width: 100%; }

.signin-btn {
    border: 1px solid var(--primary); padding: 6px 15px; border-radius: 20px; 
    font-size: 12px; transition: 0.3s;
}
.signin-btn:hover { background: var(--primary); color: white; }
.user-info { display: none; font-size: 12px; font-weight: bold; color: var(--primary); cursor: pointer; }

.nav-icons { display: flex; align-items: center; gap: 15px; }
.cart-icon-wrap { position: relative; cursor: pointer; font-size: 18px; padding: 5px; } 
.cart-count {
  position: absolute; top: -5px; right: -5px;
  background: var(--danger); color: white;
  width: 16px; height: 16px; border-radius: 50%;
  font-size: 9px; display: flex; align-items: center; justify-content: center;
}

.mobile-toggle { display: none; font-size: 22px; cursor: pointer; color: var(--primary); padding: 5px; }

.top-contact {
  background:#345b2a; color:#fff; text-align:center;
  padding:5px 10px; font-size:0.75rem; font-weight: 600;
}

/* ---------- 5. Hero Section ---------- */
.hero {
  position: relative; height: 60vh; min-height: 450px;
  background: url('https://images.unsplash.com/photo-1540555700478-4be289fbecef?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') center/cover no-repeat;
  display: flex; align-items: center; margin-bottom: 50px;
  transform: translateZ(0); 
}
.hero::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(to right, rgba(0,0,0,0.5), rgba(0,0,0,0.1));
}
.hero-content {
  position: relative; z-index: 2; color: white;
  max-width: 600px; padding-left: 5%;
  animation: slideUp 0.8s ease-out;
}
.hero h1 { font-size: 38px; line-height: 1.2; margin-bottom: 15px; color: white; }
.hero p { font-size: 15px; margin-bottom: 25px; opacity: 0.95; }

@keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

/* ---------- 6. Products ---------- */
.section-title { text-align: center; margin-bottom: 35px; }
.section-title h2 { font-size: 28px; margin-bottom: 8px; }

.filter-container {
  display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 25px; align-items: center;
}
.search-box { position: relative; width: 100%; max-width: 280px; margin: 0 auto 12px auto; }
.search-box input {
  width: 100%; padding: 10px 18px; padding-right: 35px; border-radius: 50px;
  border: 1px solid #ddd; outline: none; font-size: 13px;
}
.search-box i { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #aaa; }
.filter-btn {
  padding: 6px 16px; border-radius: 50px; border: 1px solid #ddd; background: white;
  cursor: pointer; transition: var(--transition); font-size: 12px; font-weight: 600;
}
.filter-btn.active, .filter-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

.products-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px; padding-bottom: 50px;
}

.product-card {
  background: white; border-radius: var(--radius); overflow: hidden;
  box-shadow: var(--shadow); transition: var(--transition); border: 1px solid #f0f0f0;
  will-change: transform;
}
.product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }

.product-img { height: 240px; overflow: hidden; position: relative; background: #f9f9f9; }
.product-img img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
.product-card:hover .product-img img { transform: scale(1.05); }

.product-info { padding: 15px; text-align: center; }
.product-title { font-size: 16px; margin: 6px 0; color: var(--text-dark); }
.product-price { font-weight: 700; color: var(--primary); font-size: 15px; margin-bottom: 10px; }

.card-qty-wrapper {
    display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 12px;
}
.qty-mini-btn {
    width: 22px; height: 22px; background: #eee; border-radius: 50%; font-weight: bold;
    display: flex; align-items: center; justify-content: center; font-size: 14px; color: #555;
}
.card-qty-input {
    width: 35px; text-align: center; border: 1px solid #ddd; border-radius: 4px; padding: 2px; font-size: 12px;
}
.card-btns { display: flex; gap: 6px; justify-content: center; }

/* ---------- 7. Modals ---------- */
.overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  z-index: 999; opacity: 0; visibility: hidden; transition: var(--transition);
}
.overlay.active { opacity: 1; visibility: visible; }

.modal {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95);
  width: 90%; max-width: 500px; background: white;
  z-index: 1000; border-radius: 12px; padding: 25px;
  opacity: 0; visibility: hidden; transition: var(--transition);
  box-shadow: 0 25px 50px rgba(0,0,0,0.25);
  max-height: 90vh; overflow-y: auto;
}
.modal.active { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }

.form-group { margin-bottom: 12px; }
.form-group label { display: block; margin-bottom: 5px; font-size: 12px; font-weight: 700; }
.form-group input, .form-group textarea, .form-group select {
  width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;
}

/* ---------- 8. Cart Drawer ---------- */
.cart-drawer {
  position: fixed; top: 0; right: -100%; width: 100%; max-width: 380px; height: 100%;
  background: white; z-index: 1001; transition: var(--transition);
  display: flex; flex-direction: column; box-shadow: -5px 0 25px rgba(0,0,0,0.1);
}
.cart-drawer.active { right: 0; }
.cart-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
.cart-body { flex: 1; overflow-y: auto; padding: 20px; }
.cart-item { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; background: #fff; }
.cart-item img { width: 50px; height: 50px; border-radius: 6px; object-fit: cover; }
.cart-controls { display: flex; align-items: center; gap: 6px; margin-top: 5px; flex-wrap: wrap; }
.qty-btn { width: 24px; height: 24px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; }
.cart-qty-input { width: 35px; padding: 2px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;}
.bulk-btn { background: #e0e0e0; font-size: 10px; padding: 2px 6px; border-radius: 4px; }

/* ---------- 9. Social Media Bar ---------- */
.social-bar {
  position: fixed; bottom: 0; left: 0; width: 100%;
  background: white; border-top: 1px solid #eee;
  display: flex; justify-content: space-around; align-items: center;
  padding: 8px 0; z-index: 900;
  box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
}
.social-link {
  display: flex; flex-direction: column; align-items: center;
  font-size: 11px; color: var(--text-dark); gap: 3px;
}
.social-link i { font-size: 18px; transition: transform 0.2s; }
.social-link:hover i { transform: translateY(-3px); }
.fa-whatsapp { color: #25d366; }
.fa-instagram { color: #C13584; }
.fa-facebook { color: #1877F2; }

/* Toast */
.toast {
  position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: rgba(30,30,30,0.9); color: white; padding: 8px 16px; border-radius: 30px;
  font-size: 13px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 2000;
  display: flex; align-items: center; gap: 8px; width: max-content;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Invoice (Hidden normally, used for PDF) */
#invoiceTemplate {
    display: none; padding: 20px; background: white; font-family: 'Lato', sans-serif;
    width: 600px; /* Fixed width for consistent PDF */
}
.inv-header { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
.inv-logo img { height: 60px; margin: 0 auto; display: block; border-radius: 50%; }
.inv-details { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 20px; }
.inv-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 20px; }
.inv-table th { background: #f0f0f0; padding: 8px; text-align: left; }
.inv-table td { border-bottom: 1px solid #eee; padding: 8px; }
.inv-total { text-align: right; font-size: 16px; font-weight: bold; margin-top: 10px; }
.inv-footer { text-align: center; font-size: 10px; color: #777; margin-top: 30px; border-top: 1px solid #eee; padding-top: 10px; }

/* Responsive */
@media (max-width: 768px) {
  .mobile-toggle { display: block; }
  .nav-menu {
    position: fixed; top: 0; left: -100%; width: 260px; height: 100vh;
    background: white; flex-direction: column; padding: 60px 20px;
    box-shadow: 5px 0 15px rgba(0,0,0,0.1); z-index: 1001;
    transition: left 0.3s ease;
    align-items: flex-start;
  }
  .nav-menu.active { left: 0; }
  .nav-menu a { font-size: 15px; padding: 12px 0; border-bottom: 1px solid #f5f5f5; width: 100%; }
  .hero { height: 50vh; }
  .hero h1 { font-size: 28px; }
  .cart-drawer { width: 90%; }
  .filter-container { flex-direction: column; align-items: stretch; }
  .search-box { width: 100%; max-width: none; }
  .modal { width: 95%; padding: 20px; }
}
</style>
</head>
<body>

<div class="top-contact">
  Free Shipping on orders above ₹499 | Support: +91-9595641664
</div>

<header>
  <div class="container nav-wrapper">
    <div class="mobile-toggle" onclick="toggleMenu()">
      <i class="fa-solid fa-bars"></i>
    </div>

    <a href="#" class="logo">
      <img src="herb.jpg" alt="Logo" loading="lazy">
      <span>Herbal&Heaven</span>
    </a>
    
    <nav class="nav-menu" id="mainMenu">
      <button onclick="toggleMenu()" style="position: absolute; top: 20px; right: 20px; font-size: 20px; background:none; border:none;"><i class="fa-solid fa-times"></i></button>
      <a href="#home" onclick="toggleMenu()">Home</a>
      <a href="#products" onclick="toggleMenu()">Shop</a>
      <a href="#" onclick="openTrackOrder(); toggleMenu()">Track</a>
      <a href="#" onclick="openReturnOrder(); toggleMenu()">Return</a>
      
      <a href="#" class="signin-btn" id="signInBtn" onclick="openSignIn()">Sign In</a>
      <div class="user-info" id="userInfo" onclick="openUserDashboard()">
          <i class="fa-solid fa-user"></i> <span id="userNameDisplay">User</span>
      </div>
      
      <a href="#" onclick="openAdminLogin(); toggleMenu()">Admin</a>
    </nav>
    
    <div class="nav-icons">
      <div class="cart-icon-wrap" onclick="toggleCart()">
        <i class="fa-solid fa-shopping-bag"></i>
        <span class="cart-count" id="cartCount">0</span>
      </div>
    </div>
  </div>
</header>

<div class="overlay" id="menuOverlay" onclick="toggleMenu()"></div>

<section id="home" class="hero">
  <div class="container hero-content">
    <span style="color:var(--accent); font-weight:700; letter-spacing:1px; margin-bottom:10px; display:block;">100% ORGANIC</span>
    <h1>Nature's Purest <br>Secret for You</h1>
    <p>Handcrafted, chemical-free skincare rituals designed for your inner glow.</p>
    <button class="btn btn-primary" onclick="document.getElementById('products').scrollIntoView()">Shop Now</button>
  </div>
</section>

<section id="products" class="container">
  <div class="section-title animate-in">
    <h2>Curated Rituals</h2>
  </div>

  <div class="filter-container animate-in delay-1">
    <div class="search-box">
      <input type="text" id="search" placeholder="Search soaps, oils..." onkeyup="filterProducts()">
      <i class="fa-solid fa-search"></i>
    </div>
    <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:5px; width:100%; justify-content:center;">
      <button class="filter-btn active" onclick="filterCat('all', this)">All</button>
      <button class="filter-btn" onclick="filterCat('Face', this)">Face</button>
      <button class="filter-btn" onclick="filterCat('Body', this)">Body</button>
      <button class="filter-btn" onclick="filterCat('Glow', this)">Glow</button>
    </div>
  </div>

  <div class="products-grid" id="productsGrid"></div>
</section>

<footer style="background: #222; color: #fff; padding: 40px 0; margin-bottom: 50px;">
  <div class="container" style="text-align: center;">
    <h3 style="color: white; margin-bottom: 10px;">Herbal&Heaven</h3>
    <p style="color: #888; font-size: 13px;">Nature's Pure Essence. Made with Love.</p>
  </div>
</footer>

<div class="social-bar">
    <a href="https://wa.me/919595641664" target="_blank" class="social-link">
        <i class="fa-brands fa-whatsapp"></i><span>WhatsApp</span>
    </a>
    <a href="https://instagram.com/aose_clothing" target="_blank" class="social-link">
        <i class="fa-brands fa-instagram"></i><span>Instagram</span>
    </a>
    <a href="https://facebook.com" target="_blank" class="social-link">
        <i class="fa-brands fa-facebook"></i><span>Facebook</span>
    </a>
</div>

<div class="toast" id="toast">Item added to cart</div>

<div class="overlay" id="cartOverlay" onclick="toggleCart()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-header">
    <h3>Your Bag</h3>
    <button onclick="toggleCart()" style="background:none; font-size:18px;"><i class="fa-solid fa-times"></i></button>
  </div>
  <div class="cart-body" id="cartItems"></div>
  <div class="cart-header" style="border-top:1px solid #eee; border-bottom:none; flex-direction:column; gap:15px; background:#fdfbf7;">
    <div style="display:flex; justify-content:space-between; width:100%; font-weight:700;">
      <span>Total</span>
      <span id="cartTotal">₹0</span>
    </div>
    <button class="btn btn-primary" style="width:100%;" onclick="openCheckout()">Checkout</button>
  </div>
</div>

<div class="modal" id="signInModal">
    <button onclick="closeModal('signInModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>Sign In</h3>
    <p style="font-size:13px; color:#666; margin-bottom:15px;">Access your orders and details.</p>
    <form onsubmit="handleSignIn(event)">
        <div class="form-group"><input type="text" id="signName" placeholder="Your Name" required></div>
        <div class="form-group"><input type="email" id="signEmail" placeholder="Email Address" required></div>
        <div class="form-group"><input type="tel" id="signPhone" placeholder="Phone Number" required></div>
        <button type="submit" class="btn btn-primary" style="width:100%;">Sign In</button>
    </form>
</div>

<div class="modal" id="userModal">
    <button onclick="closeModal('userModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>My Profile</h3>
    <p>Welcome back, <b id="dashboardName"></b></p>
    <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">
    <h4>My Orders</h4>
    <div id="userOrderHistory" style="max-height:200px; overflow-y:auto; font-size:12px; margin-top:10px;"></div>
    <button class="btn btn-secondary" style="width:100%; margin-top:15px;" onclick="handleSignOut()">Sign Out</button>
</div>

<div class="modal" id="trackModal">
    <button onclick="closeModal('trackModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>Track Your Order</h3>
    <div class="form-group" style="display:flex; gap:10px;">
        <input type="text" id="trackInput" placeholder="Enter Order ID" style="text-transform:uppercase;">
        <button class="btn btn-primary" onclick="trackOrderNow()">Track</button>
    </div>
    <div id="trackResult" style="display:none;"></div>
</div>

<div class="modal" id="returnModal">
    <button onclick="closeModal('returnModal')" style="position: absolute; right: 15px; top: 15px; font-size: 18px; background:none;"><i class="fa-solid fa-times"></i></button>
    <h3>Return Item</h3>
    <div id="returnStep1">
        <div class="form-group" style="display:flex; gap:10px;">
            <input type="text" id="returnInput" placeholder="Enter Order ID" style="text-transform:uppercase;">
            <button class="btn btn-primary" onclick="fetchReturnItems()">Fetch</button>
        </div>
    </div>
    <div id="returnStep2" style="display:none;">
        <div id="returnItemsList" style="margin:10px 0; max-height:150px; overflow-y:auto; border:1px solid #eee; padding:10px; border-radius:6px;"></div>
        <textarea id="returnReason" placeholder="Reason..." style="width:100%; margin-bottom:10px;" rows="2"></textarea>
        <button class="btn btn-primary" style="width:100%; background:var(--danger);" onclick="processReturn()">Confirm Return</button>
    </div>
</div>

<div class="modal" id="checkoutModal">
  <button onclick="closeModal('checkoutModal')" style="position: absolute; right: 15px; top: 15px; background:none;"><i class="fa-solid fa-times"></i></button>
  
  <div id="step1">
    <h3>Shipping Info</h3>
    <form onsubmit="goToPayment(event)">
      <div class="form-group"><input id="cName" type="text" placeholder="Full Name" required></div>
      <div class="form-group"><input id="cEmail" type="email" placeholder="Email Address" required></div>
      <div class="form-group"><input id="cPhone" type="tel" placeholder="Phone" required></div>
      <div class="form-group"><textarea id="cAddr" rows="2" placeholder="Full Address" required></textarea></div>
      <button type="submit" class="btn btn-primary" style="width:100%;">Proceed to Pay</button>
    </form>
  </div>

  <div id="step2" style="display:none; text-align:center;">
    <h3>Payment</h3>
    <p style="margin-bottom:15px;">Total: <strong id="payAmount"></strong></p>
    <div style="display:grid; gap:10px; margin-bottom:20px;">
      <button class="btn" style="background:#4285F4; color:white;" onclick="pay('Google Pay')">Google Pay</button>
      <button class="btn" style="background:#5F259F; color:white;" onclick="pay('PhonePe')">PhonePe</button>
      <button class="btn" style="background:#00B9F1; color:white;" onclick="pay('Paytm')">Paytm</button>
    </div>
    <p style="font-size:12px; color:#666;">OR Scan QR Code</p>
    <img id="qrImg" style="width:150px; margin:10px auto; border:1px solid #eee;">
    <button class="btn btn-success" style="background:var(--success); color:white; width:100%;" onclick="confirmOrder()">I have Paid</button>
  </div>
  
  <div id="step3" style="display:none; text-align:center;">
    <i class="fa-solid fa-circle-check" style="color:var(--success); font-size:40px; margin-bottom:10px;"></i>
    <h3>Order Placed!</h3>
    <h2 id="finalOrderId" style="letter-spacing:1px; margin:10px 0;"></h2>
    <p style="font-size:13px; margin-bottom:15px;">A confirmation was sent to you.</p>
    <button class="btn btn-primary" onclick="downloadInvoice()">Download Invoice</button>
    <button class="btn btn-secondary" onclick="closeModal('checkoutModal'); location.reload();">Close</button>
  </div>
</div>

<div class="modal" id="adminModal">
  <button onclick="closeModal('adminModal')" style="position: absolute; right: 15px; top: 15px; background:none;"><i class="fa-solid fa-times"></i></button>
  <div id="adminLogin">
    <h3>Admin Login</h3>
    <input type="password" id="admPass" placeholder="Password" style="width:100%; padding:10px; margin:15px 0;">
    <button class="btn btn-primary" onclick="checkAdmin()">Login</button>
  </div>
  <div id="adminDash" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
      <h3>Dashboard</h3>
      <button class="btn btn-primary" onclick="refreshData()"><i class="fa-solid fa-rotate-right"></i></button>
    </div>
    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <button class="btn btn-secondary" onclick="exportOrders()">Orders .xlsx</button>
        <button class="btn btn-secondary" onclick="exportCustomers()">Customers .xlsx</button>
    </div>
    <div style="overflow-x:auto; max-height: 400px;">
        <table style="width:100%; font-size:12px; text-align:left; border-collapse:collapse;" id="orderTable">
            <thead><tr style="background:#f5f5f5;"><th>ID/Status</th><th>Items</th><th>Actions</th></tr></thead>
            <tbody id="orderBody"></tbody>
        </table>
    </div>
    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px dashed #eee; text-align: center;">
        <button class="btn" style="background: var(--danger); color: white;" onclick="resetDatabase()">
            <i class="fa-solid fa-trash"></i> Reset Database
        </button>
    </div>
  </div>
</div>

<div id="invoiceTemplate">
    <div class="inv-header">
        <div class="inv-logo"><img src="herb.jpg" alt="Logo"></div>
        <h2>Herbal&Heaven</h2>
        <p style="font-size:12px; color:#555;">Rashin, Karjat, Ahmednagar, 414403</p>
        <p style="font-size:12px; color:#555;">+91-9595641664 | aoseofficial77@gmail.com</p>
    </div>
    <div class="inv-details">
        <div>
            <strong>Bill To:</strong><br>
            <span id="invCustName"></span><br>
            <span id="invCustPhone"></span><br>
            <span id="invCustAddr"></span>
        </div>
        <div style="text-align:right;">
            <strong>Invoice #:</strong> <span id="invId"></span><br>
            <strong>Date:</strong> <span id="invDate"></span>
        </div>
    </div>
    <table class="inv-table">
        <thead>
            <tr><th>Item</th><th>Qty</th><th style="text-align:right;">Price</th><th style="text-align:right;">Total</th></tr>
        </thead>
        <tbody id="invItemsBody"></tbody>
    </table>
    <div class="inv-total">Total Amount: ₹<span id="invFinalTotal"></span></div>
    <div class="inv-footer">Thank you for choosing Nature's Purest.</div>
</div>

<script>
// --- CONFIG ---
const UPI_ID = "damareomkar96@oksbi";
const ADMIN_PASS = "omti96";
const OWNER_PHONE = "919595641664"; 
const SECRET_CODE = "DELETE99"; 

// --- DATA ---
const products = [
  { id: 1, name: "Neem Soap", cat: "Face", price: 150, img: "proo.jpg" },
  { id: 2, name: "Papaya Soap", cat: "Glow", price: 150, img: "pro.jpg" },
  { id: 3, name: "Tulsi Soap", cat: "Body", price: 150, img: "pro1.jpg" },
  { id: 4, name: "Aloe Vera", cat: "Face", price: 150, img: "pro4.jpg" },
  { id: 5, name: "Detan Bar", cat: "Glow", price: 150, img: "pro5.jpg" },
  { id: 6, name: "Rose Soap", cat: "Body", price: 150, img: "pro3.jpg" },
  { id: 7, name: "Charcoal", cat: "Face", price: 150, img: "pro7.jpg" },
  { id: 8, name: "Multani", cat: "Glow", price: 150, img: "pro8.jpg" }
];

let cart = [];
let orders = JSON.parse(localStorage.getItem('hh_orders') || '[]');
let customers = JSON.parse(localStorage.getItem('hh_customers') || '[]');
let currentUser = JSON.parse(localStorage.getItem('hh_current_user') || 'null');
let currentCompletedOrder = null; // Stores last order for Invoice
let payMethod = '';

// --- INIT ---
window.onload = () => {
    renderProducts(products);
    updateUserUI();
};

// --- GENERIC MODAL UTILS ---
function closeModal(id) {
    document.getElementById(id).classList.remove('active');
    document.querySelector('.overlay').classList.remove('active');
}
function openModal(id) {
    document.getElementById(id).classList.add('active');
    document.querySelector('.overlay').classList.add('active');
}

// --- USER SYSTEM ---
function updateUserUI() {
    if(currentUser) {
        document.getElementById('signInBtn').style.display = 'none';
        document.getElementById('userInfo').style.display = 'block';
        document.getElementById('userNameDisplay').innerText = currentUser.name;
    } else {
        document.getElementById('signInBtn').style.display = 'block';
        document.getElementById('userInfo').style.display = 'none';
    }
}
function openSignIn() { openModal('signInModal'); }
function handleSignIn(e) {
    e.preventDefault();
    const name = document.getElementById('signName').value;
    const email = document.getElementById('signEmail').value;
    const phone = document.getElementById('signPhone').value;
    
    currentUser = { name, email, phone };
    localStorage.setItem('hh_current_user', JSON.stringify(currentUser));
    
    if(!customers.find(c => c.email === email)) {
        customers.push({name, email, phone, date: new Date().toLocaleDateString()});
        localStorage.setItem('hh_customers', JSON.stringify(customers));
    }
    
    closeModal('signInModal');
    updateUserUI();
    showToast(`Welcome, ${name}!`);
}
function handleSignOut() {
    localStorage.removeItem('hh_current_user');
    currentUser = null;
    closeModal('userModal');
    updateUserUI();
    showToast("Signed Out.");
}
function openUserDashboard() {
    if(!currentUser) return;
    document.getElementById('dashboardName').innerText = currentUser.name;
    const myOrders = orders.filter(o => o.email === currentUser.email || o.phone === currentUser.phone);
    const container = document.getElementById('userOrderHistory');
    
    if(myOrders.length === 0) container.innerHTML = "<p>No orders yet.</p>";
    else {
        container.innerHTML = myOrders.map(o => `
            <div style="border-bottom:1px solid #eee; padding:5px 0;">
                <strong>${o.id}</strong> - <span style="color:var(--primary)">${o.status}</span><br>
                Items: ${o.items.length} | Total: ₹${o.total}<br>
                <small>${o.date}</small>
            </div>
        `).join('');
    }
    openModal('userModal');
}

// --- PRODUCTS ---
function renderProducts(list) {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = list.map((p, i) => `
        <div class="product-card animate-in" style="animation-delay: ${i*0.05}s">
            <div class="badge">Pure</div>
            <div class="product-img"><img src="${p.img}" alt="${p.name}" loading="lazy"></div>
            <div class="product-info">
                <h3 class="product-title">${p.name}</h3>
                <div class="product-price">₹${p.price}</div>
                <div class="card-qty-wrapper">
                    <button class="qty-mini-btn" onclick="updateCardQty('${p.id}', -1)">-</button>
                    <input type="text" id="card-qty-${p.id}" class="card-qty-input" value="1" readonly>
                    <button class="qty-mini-btn" onclick="updateCardQty('${p.id}', 1)">+</button>
                </div>
                <div class="card-btns">
                    <button class="btn btn-primary" onclick="addToCart(${p.id})">Add</button>
                    <button class="btn btn-secondary" onclick="buyNow(${p.id})">Buy</button>
                </div>
            </div>
        </div>
    `).join('');
}
function updateCardQty(id, chg) {
    const el = document.getElementById(`card-qty-${id}`);
    let v = parseInt(el.value) + chg;
    if(v<1) v=1; el.value = v;
}
function filterProducts() {
    const q = document.getElementById('search').value.toLowerCase();
    renderProducts(products.filter(p => p.name.toLowerCase().includes(q)));
}
function filterCat(cat, btn) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderProducts(cat === 'all' ? products : products.filter(p => p.cat.includes(cat)));
}

// --- CART ---
function addToCart(id) {
    const p = products.find(x => x.id === id);
    const qtyInput = document.getElementById(`card-qty-${id}`);
    const qty = parseInt(qtyInput ? qtyInput.value : 1);
    const ex = cart.find(x => x.id === id);
    if(ex) ex.qty += qty; else cart.push({...p, qty});
    if(qtyInput) qtyInput.value = 1;
    updateCart(); showToast("Added to Bag");
}
function updateCart() {
    const count = cart.reduce((a,b) => a+b.qty, 0);
    const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
    document.getElementById('cartCount').innerText = count;
    document.getElementById('cartTotal').innerText = '₹' + total;
    document.getElementById('cartItems').innerHTML = cart.length ? cart.map(i => `
        <div class="cart-item">
            <img src="${i.img}">
            <div style="flex:1;">
                <div style="font-weight:700; font-size:13px;">${i.name}</div>
                <div style="font-size:11px; color:#666;">₹${i.price}</div>
                <div class="cart-controls">
                    <button class="qty-btn" onclick="modQty(${i.id}, -1)">-</button>
                    <input type="number" class="cart-qty-input" value="${i.qty}" onchange="manualCartQty(${i.id}, this.value)">
                    <button class="qty-btn" onclick="modQty(${i.id}, 1)">+</button>
                    <button class="bulk-btn" onclick="modQty(${i.id}, 10)">+10</button>
                </div>
            </div>
        </div>
    `).join('') : '<p style="text-align:center; color:#999; font-size:12px;">Empty Bag</p>';
}
function modQty(id, n) {
    const i = cart.find(x => x.id === id);
    if(i) { i.qty += n; if(i.qty <= 0) cart = cart.filter(x => x.id !== id); }
    updateCart();
}
function manualCartQty(id, v) {
    const i = cart.find(x => x.id === id);
    if(i) { i.qty = parseInt(v) > 0 ? parseInt(v) : 1; }
    updateCart();
}
function toggleCart() {
    const d = document.getElementById('cartDrawer');
    const o = document.getElementById('cartOverlay');
    if(d.classList.contains('active')) { d.classList.remove('active'); o.classList.remove('active'); }
    else { d.classList.add('active'); o.classList.add('active'); }
}
function buyNow(id) { cart=[]; addToCart(id); toggleCart(); openCheckout(); }

// --- CHECKOUT ---
function openCheckout() {
    if(!cart.length) return showToast("Cart is empty");
    toggleCart(); openModal('checkoutModal');
    // Pre-fill if logged in
    if(currentUser) {
        document.getElementById('cName').value = currentUser.name;
        document.getElementById('cEmail').value = currentUser.email;
        document.getElementById('cPhone').value = currentUser.phone;
    }
    document.getElementById('step1').style.display = 'block';
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'none';
}
function goToPayment(e) {
    e.preventDefault();
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
    const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
    document.getElementById('payAmount').innerText = '₹' + total;
    const url = `upi://pay?pa=${UPI_ID}&pn=HerbalHeaven&am=${total}&cu=INR`;
    document.getElementById('qrImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
}
function pay(m) { payMethod = m; goToPayment(new Event('click')); }
function confirmOrder() {
    const name = document.getElementById('cName').value;
    const email = document.getElementById('cEmail').value;
    const phone = document.getElementById('cPhone').value;
    const addr = document.getElementById('cAddr').value;
    const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
    const uid = "HH-" + Math.random().toString(36).substr(2, 4).toUpperCase();

    // Create Order Object
    const order = {
        id: uid, date: new Date().toLocaleDateString(),
        customer: name, email, phone, address: addr,
        items: [...cart], // Clone cart items for storage
        total, method: payMethod || 'QR', status: 'Placed'
    };
    
    // Save locally
    orders.push(order);
    localStorage.setItem('hh_orders', JSON.stringify(orders));
    currentCompletedOrder = order; // Save for invoice

    // Notify Owner
    const msg = `New Order! ID: ${uid} Name: ${name} Total: ₹${total}`;
    window.open(`https://wa.me/${OWNER_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');

    document.getElementById('finalOrderId').innerText = uid;
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'block';
    
    // Populate Invoice HTML (Hidden)
    document.getElementById('invId').innerText = uid;
    document.getElementById('invDate').innerText = order.date;
    document.getElementById('invCustName').innerText = name;
    document.getElementById('invCustPhone').innerText = phone;
    document.getElementById('invCustAddr').innerText = addr;
    document.getElementById('invFinalTotal').innerText = total;
    document.getElementById('invItemsBody').innerHTML = order.items.map(i => 
        `<tr><td>${i.name}</td><td>${i.qty}</td><td style="text-align:right;">${i.price}</td><td style="text-align:right;">${i.price*i.qty}</td></tr>`
    ).join('');

    cart = []; updateCart();
}

// --- INVOICE ---
function downloadInvoice() {
    if(!currentCompletedOrder) return alert("No order found!");
    const element = document.getElementById('invoiceTemplate');
    element.style.display = 'block'; // Make visible for capture
    
    html2pdf(element, {
        margin: 10,
        filename: `Invoice_${currentCompletedOrder.id}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    }).then(() => {
        element.style.display = 'none'; // Hide again
    });
}

// --- TRACK & RETURN ---
function openTrackOrder() { openModal('trackModal'); }
function trackOrderNow() {
    const id = document.getElementById('trackInput').value.trim().toUpperCase();
    const o = orders.find(x => x.id === id);
    const r = document.getElementById('trackResult');
    r.style.display = 'block';
    if(o) r.innerHTML = `<div style="background:#f9f9f9; padding:10px; border:1px solid #eee; border-radius:6px; margin-top:10px;"><b>${o.id}</b>: <span style="color:var(--primary)">${o.status}</span><br>Date: ${o.date}<br>Total: ₹${o.total}</div>`;
    else r.innerHTML = "<p style='color:red; margin-top:10px;'>Order not found.</p>";
}
function openReturnOrder() { openModal('returnModal'); document.getElementById('returnStep1').style.display = 'block'; document.getElementById('returnStep2').style.display = 'none'; }
function fetchReturnItems() {
    const id = document.getElementById('returnInput').value.trim().toUpperCase();
    const o = orders.find(x => x.id === id);
    if(o) {
        currentReturnOrderId = o.id;
        document.getElementById('returnStep1').style.display = 'none';
        document.getElementById('returnStep2').style.display = 'block';
        document.getElementById('returnItemsList').innerHTML = o.items.map(i => `<div><input type="checkbox" value="${i.name}"> ${i.name}</div>`).join('');
    } else alert("Order not found");
}
function processReturn() {
    const reason = document.getElementById('returnReason').value;
    const msg = `RETURN: ${currentReturnOrderId} Reason: ${reason}`;
    window.open(`https://wa.me/${OWNER_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
    closeModal('returnModal');
}

// --- ADMIN & MENU ---
function toggleMenu() {
    const m = document.getElementById('mainMenu');
    const o = document.getElementById('menuOverlay');
    if(m.classList.contains('active')) { m.classList.remove('active'); o.classList.remove('active'); }
    else { m.classList.add('active'); o.classList.add('active'); }
}
function showToast(msg) {
    const t = document.getElementById('toast');
    t.innerText = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}
function openAdminLogin() { openModal('adminModal'); document.getElementById('adminLogin').style.display = 'block'; document.getElementById('adminDash').style.display = 'none'; }
function checkAdmin() {
    if(document.getElementById('admPass').value === ADMIN_PASS) {
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminDash').style.display = 'block';
        refreshData();
    } else alert("Wrong Password");
}
function refreshData() {
    document.getElementById('orderBody').innerHTML = orders.map((o, index) => 
        `<tr style="border-bottom:1px solid #eee;">
            <td style="padding:8px;">
                <strong>${o.id}</strong><br>
                <select onchange="updateStatus(${index}, this.value)" style="font-size:11px; padding:2px;">
                    <option value="Placed" ${o.status === 'Placed' ? 'selected' : ''}>Placed</option>
                    <option value="Shipped" ${o.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                    <option value="Delivered" ${o.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                </select>
            </td>
            <td style="padding:8px; font-size:11px;">${o.items.map(i=>`${i.name}(${i.qty})`).join(', ')}</td>
            <td style="padding:8px; white-space:nowrap;">
                <button class="btn-icon" style="background:#25d366" onclick="notifyWA('${o.phone}', '${o.customer}', '${o.id}', '${o.total}')"><i class="fa-brands fa-whatsapp"></i></button>
                <button class="btn-icon" style="background:#DB4437" onclick="notifyEmail('${o.email}', '${o.customer}', '${o.id}', '${o.total}')"><i class="fa-solid fa-envelope"></i></button>
            </td>
        </tr>`
    ).join('');
}
function updateStatus(index, newStatus) {
    orders[index].status = newStatus;
    localStorage.setItem('hh_orders', JSON.stringify(orders));
    showToast("Status Updated!");
}
function notifyWA(phone, name, id, total) {
    const msg = `Hi ${name}, Your order ${id} of ₹${total} is confirmed! - Herbal&Heaven`;
    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
}
function notifyEmail(email, name, id, total) {
    const subject = `Order Confirmed: ${id}`;
    const body = `Hi ${name},\n\nOrder ${id} amounting to ₹${total} is confirmed.\n\nRegards,\nOmkar`;
    window.open(`mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
}
function resetDatabase() {
    const code = prompt("Enter Secret Code to DELETE ALL DATA:");
    if(code === SECRET_CODE) {
        if(confirm("Are you sure? This cannot be undone.")) {
            localStorage.removeItem('hh_orders');
            localStorage.removeItem('hh_customers');
            orders = []; customers = []; refreshData(); alert("Database Wiped.");
        }
    } else alert("Incorrect Code.");
}
function exportOrders() {
    const ws = XLSX.utils.json_to_sheet(orders.map(o => ({
        ID: o.id, Status: o.status, Date: o.date, Name: o.customer, Phone: o.phone, 
        Total: o.total, Items: o.items.map(i=>`${i.name}(${i.qty})`).join(', ')
    })));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Orders");
    XLSX.writeFile(wb, "Orders.xlsx");
}
function exportCustomers() {
    const ws = XLSX.utils.json_to_sheet(customers);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Customers");
    XLSX.writeFile(wb, "Customers.xlsx");
}
</script>
</body>
</html>
